#!/bin/sh
set -eu

c_h_S_files=$(find -name '*.c' -o -name '*.h' -o -name '*.S')
etags --declarations $c_h_S_files

# note, some makefiles in scripts/ have .include suffix
makefiles=$(find -name 'Makefile*' -o -name '.config*' -o -path './scripts/*.include')
etags --append -l makefile $makefiles

kconfigs=$(find -name 'Kconfig*')
# For symbols in Kconfig files generate both <symbol> and
# CONFIG_<symbol> forms. The former is for search from Kconfig files,
# b/c there is no CONFIG_ prefix there. The latter is for search from
# all other kernel source files where CONFIG_<symbol> form is used.
etags --append -l none -r '/^\(menu\)?config \([A-Za-z0-9_]+\)$/\2/' $kconfigs
etags --append -l none -r '/^\(menu\)?config \([A-Za-z0-9_]+\)$/CONFIG_\2/' $kconfigs
